<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Netcore-igdmptd-后门漏洞分析 - Jian&#39;s Life</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Netcore-igdmptd-后门漏洞分析" />
<meta property="og:description" content="磊科路由器中内置了一个IGDMPTD的程序, 在外网上打开UDP端口53413 并进行监听. 后门采用硬编码的密码,允许攻击者在路由器上执行任意代码.
知道了这些之后,进行分析
仿真:
使用qemu 系统模式作为测试环境
固件: https://github.com/rapid7/metasploit-framework/files/267284/vuln_squashfs-root.tar.gz
scp -P 22 vuln_squashfs-root.tar.gz root@[target_ip]:/root tar xvf vuln_squashfs-root.tar.gz cd squashfs-root chroot ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/post/netcore_igdmptd_backdoor_analysis/" />
<meta property="article:published_time" content="2020-02-27T13:53:04&#43;08:00"/>
<meta property="article:modified_time" content="2020-02-27T13:53:04&#43;08:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Netcore-igdmptd-后门漏洞分析"/>
<meta name="twitter:description" content="磊科路由器中内置了一个IGDMPTD的程序, 在外网上打开UDP端口53413 并进行监听. 后门采用硬编码的密码,允许攻击者在路由器上执行任意代码.
知道了这些之后,进行分析
仿真:
使用qemu 系统模式作为测试环境
固件: https://github.com/rapid7/metasploit-framework/files/267284/vuln_squashfs-root.tar.gz
scp -P 22 vuln_squashfs-root.tar.gz root@[target_ip]:/root tar xvf vuln_squashfs-root.tar.gz cd squashfs-root chroot ."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="http://example.org/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://example.org/css/main.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="http://example.org/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="http://example.org/">Jian&#39;s Life</a></h1>
	<div class="site-description"><h2>new life</h2><nav class="nav social">
			<ul class="flat"><a href="mailto:polaalemu@gmail.com" title="Gmail"><i data-feather="mail"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Netcore-igdmptd-后门漏洞分析</h1>
			<div class="meta">Posted at &mdash; Feb 27, 2020</div>
		</div>

		<div class="markdown">
			<p>磊科路由器中内置了一个IGDMPTD的程序, 在外网上打开UDP端口53413 并进行监听.
后门采用硬编码的密码,允许攻击者在路由器上执行任意代码.</p>

<p>知道了这些之后,进行分析</p>

<p>仿真:</p>

<p>使用qemu 系统模式作为测试环境</p>

<p>固件: <a href="https://github.com/rapid7/metasploit-framework/files/267284/vuln_squashfs-root.tar.gz">https://github.com/rapid7/metasploit-framework/files/267284/vuln_squashfs-root.tar.gz</a></p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">scp -P 22 vuln_squashfs-root.tar.gz root@[target_ip]:/root

tar xvf vuln_squashfs-root.tar.gz

cd squashfs-root 

chroot . ./bin/igdmpt</pre></div>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcc5x7c6rmj30mi01q3yn.jpg" alt="" />
可以看到端口已经打开
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcc5wixuw5j30m402maa7.jpg" alt="" /></p>

<p>使用poc可以发现确实存在漏洞
<img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcc66gr69hj30u007c3za.jpg" alt="" /></p>

<p>create_server 函数中</p>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gcca3q1p6mj30kg0qgwj8.jpg" alt="" /></p>

<p>bind:</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">       int bind(int sockfd, const struct sockaddr *addr,
                socklen_t addrlen);`</pre></div>
<p>addr =[family][ip][port] = 0xa5d00002</p>

<p>0xd05a = 53413 :端口号<br />
0x00 = 0 : ip , INADDR_ANY =0 ,监听所有地址<br />
0x02 = 2 :sa_family = 2,即SOCK_DGRAM ,表示UDP连接</p>

<p>这里ip设置为监听所有地址,所以设备会被暴露在公网上,很危险.</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">/* Socket types. */
#define SOCK_STREAM	1		/* stream (connection) socket	*/
#define SOCK_DGRAM	2		/* datagram (conn.less) socket	*/


# define INADDR_ANY ((unsigned long int) 0x00000000)
...
# define INADDR_NONE    0xffffffff
...
# define INPORT_ANY 0
...</pre></div>
<p>敏感功能:</p>

<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gccclynh5aj309i05mweq.jpg" alt="" /></p>

<p>Poc脚本:<a href="https://github.com/h00die/MSF-Testing-Scripts/blob/master/netis_backdoor.py">https://github.com/h00die/MSF-Testing-Scripts/blob/master/netis_backdoor.py</a></p>

<p>参考链接:
<a href="https://blog.trendmicro.com/trendlabs-security-intelligence/netis-router-backdoor-patched-but-not-really/">https://blog.trendmicro.com/trendlabs-security-intelligence/netis-router-backdoor-patched-but-not-really/</a>
<a href="https://blog.knownsec.com/wp-content/uploads/2015/01/NetcoreNetis-%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%8E%E9%97%A8%E5%BA%94%E6%80%A5%E6%A6%82%E8%A6%81.pdf">https://blog.knownsec.com/wp-content/uploads/2015/01/NetcoreNetis-%E8%B7%AF%E7%94%B1%E5%99%A8%E5%90%8E%E9%97%A8%E5%BA%94%E6%80%A5%E6%A6%82%E8%A6%81.pdf</a>
<a href="https://github.com/h00die/MSF-Testing-Scripts/blob/master/netis_backdoor.py">https://github.com/h00die/MSF-Testing-Scripts/blob/master/netis_backdoor.py</a></p>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/iot">IoT</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script>feather.replace()</script>
</body>
</html>
